<div class="my-div"><h1 id="heaps-push-and-pop">Heaps Push and Pop</h1>
<hr>
<h2 id="push">Push</h2>
<p>Taking the same binary heap from before: <code class="hljs language-java"><span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">68</span><span class="token punctuation">,</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">]</span></code>, let's say we wish to push <code class="hljs language-undefined">17</code>. We need to make sure we push <code class="hljs language-undefined">17</code> such that we maintain our structure and order property. </p>
<p>Since a binary heap is a complete binary tree, and we are required to fill nodes in a contigious fashion, pushing <code class="hljs language-undefined">17</code> should happen at the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn></mrow><annotation encoding="application/x-tex">10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">10</span></span></span></span>th index. However, this might violate the min heap property, which means we will have to percolate <code class="hljs language-undefined">17</code> up the tree until we find its correct position.</p>
<p>In this case, because <code class="hljs language-undefined">17</code> is less than its parent, <code class="hljs language-undefined">26</code>, it needs to percolate up until it is no longer less than its parent. So, we swap <code class="hljs language-undefined">17</code> with <code class="hljs language-undefined">26</code> and now <code class="hljs language-undefined">17</code>'s parent is <code class="hljs language-undefined">19</code>, which again violates the min-heap property. We perform another swap. After that <code class="hljs language-undefined">17</code> is now greater than its new parent, which is <code class="hljs language-undefined">14</code>. <code class="hljs language-undefined">17</code> is also smaller than all of its descendents because <code class="hljs language-undefined">19</code> was already smaller than all of its descendents. The resulting min-heap would look like the following.</p>
<p><img src="https://imagedelivery.net/CLfkmk9Wzy8_9HRyug4EVA/62bed605-429f-4c70-6eeb-5d88328c7300/sharpen=1" alt="dsa-heaps-pushandpop"></p>
<div class="code-toolbar"><pre class="language-cpp" tabindex="0"><code class="hljs language-cpp"><span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">int</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    heap_<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> heap_<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
<br>
    <span class="token comment">// Percolate up</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> heap_<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> heap_<span class="token punctuation">[</span>i <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> tmp <span class="token operator">=</span> heap_<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        heap_<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> heap_<span class="token punctuation">[</span>i <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        heap_<span class="token punctuation">[</span>i <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
        i <span class="token operator">=</span> i <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<blockquote>
<p>The "//" indicates taking the floor of the resulting answer so we can round down, e.g. <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5.5</mn></mrow><annotation encoding="application/x-tex">5.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">5.5</span></span></span></span> becomes <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">5</span></span></span></span> since indices are whole numbers. </p>
</blockquote>
<p>Since we know the tree will always be balanced, the time complexity of the push operation is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mtext>&nbsp;</mtext><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(log\ n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace">&nbsp;</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>.</p>
<hr>
<h2 id="pop">Pop</h2>
<h3 id="the-obvious-way">The obvious way</h3>
<p>Popping from a heap is more complicated than the push operation. One way that you might have already thought about is pop the root node and replace it with <code class="hljs language-stylus">min(left_child, right_child)</code>. The issue here is that while the order property is intact, we have violated the structure property. Taking the tree from before, popping <code class="hljs language-undefined">14</code>, and swapping it with <code class="hljs language-undefined">16</code> - <code class="hljs language-stylus">min(left_child, right_child)</code> would require <code class="hljs language-undefined">19</code> to replace <code class="hljs language-undefined">16</code>. Now, level <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span> has a missing node i.e <code class="hljs language-undefined">19</code> is missing a left child.</p>
<h3 id="the-correct-way">The correct way</h3>
<p>The correct way is to take the right-most node of the last level and swap it with the root node. We have now maintained the structure property. However, the order property is violated. To fix the order property, we have to make sure that <code class="hljs language-undefined">30</code> finds its place. To do so, we will run a loop and swap <code class="hljs language-undefined">30</code> with <code class="hljs language-stylus">min(left_child, right_child)</code>. We swap <code class="hljs language-undefined">30</code> with <code class="hljs language-undefined">16</code>, then <code class="hljs language-undefined">19</code> with <code class="hljs language-undefined">30</code>. The resulting tree will look like the following.</p>
<p><img src="https://imagedelivery.net/CLfkmk9Wzy8_9HRyug4EVA/c9b06f3d-0661-4fce-f281-3922384e3100/sharpen=1" alt="dsa-heaps-pushandpop"></p>
<div class="code-toolbar"><pre class="language-cpp" tabindex="0"><code class="hljs language-cpp"><span class="token keyword">int</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>heap_<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Normally we would throw an exception if heap is empty.</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>heap_<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> res <span class="token operator">=</span> heap_<span class="token punctuation">[</span>heap_<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        heap_<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <br>
    <span class="token keyword">int</span> res <span class="token operator">=</span> heap_<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// Move last value to root</span>
    heap_<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> heap_<span class="token punctuation">[</span>heap_<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    heap_<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">// Percolate down</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">&lt;</span> heap_<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> heap_<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> 
        heap_<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> heap_<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span>
        heap_<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> heap_<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Swap right child</span>
            <span class="token keyword">int</span> tmp <span class="token operator">=</span> heap_<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            heap_<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> heap_<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            heap_<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
            i <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>heap_<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> heap_<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Swap left child</span>
            <span class="token keyword">int</span> tmp <span class="token operator">=</span> heap_<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            heap_<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> heap_<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            heap_<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
            i <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>The pseudocode shown above might seem daunting at first so let's go over it. If our <code class="hljs language-ebnf">heap</code> is empty, there is nothing to pop, hence the <code class="hljs language-kotlin"><span class="token keyword">return</span> <span class="token keyword">null</span></code>. Our heap also could have just one node, in which case, we will just pop that node and don't need to make any adjustments. If the above two statements have not executed, it must be the case that we have children, meaning we need to perform a swap. </p>
<p>We store our <code class="hljs language-undefined">14</code> into a variable called <code class="hljs language-ebnf">res</code> so that we don't lose it. Then, we can pop from our heap, and replace <code class="hljs language-undefined">30</code> to be at the root node. </p>
<p>Our while loop runs as long as we have a left child and we determine this by making sure <code class="hljs language-basic">2 * i</code> is not out of bounds. Then, there are three cases we concern ourselves with: </p>
<ol>
<li>The node has no children</li>
<li>The node <em><strong>only</strong></em> has a left child </li>
<li>The node has two children</li>
</ol>
<blockquote>
<p>When considering a binary heap, it is not possible to have only a right child because then it no longer is a complete binary tree and violates the structure property.</p>
</blockquote>
<p>Because we are guarenteed to have a left child in the while loop, we need to now check if the node also has a right child, which we check by <code class="hljs language-basic">2 * i + 1</code>. We also make sure that the current node is greater than its children because of the order property. We replace the node with the minimum of its two children. </p>
<p>If no right child exists and the current node's value is greater than its left child, we swap it with the left child. </p>
<p>If none of the above cases exectue, then it must be the case that our node is in the proper position already, satisfying both the order and the structural property. </p>
<hr>
<h2 id="closing-notes">Closing Notes</h2>
<p>The time complexity of the operations discussed so far can be summarized by the following table.</p>
<table class="table is-bordered">
<thead>
<tr>
<th>Operation</th>
<th>Big-O Time</th>
</tr>
</thead>
<tbody><tr>
<td>Get Min/Max</td>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></td>
</tr>
<tr>
<td>Push</td>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mtext>&nbsp;</mtext><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(log\ n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace">&nbsp;</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></td>
</tr>
<tr>
<td>Pop</td>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mtext>&nbsp;</mtext><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(log\ n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace">&nbsp;</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></td>
</tr>
</tbody></table>
<hr>
</div>
